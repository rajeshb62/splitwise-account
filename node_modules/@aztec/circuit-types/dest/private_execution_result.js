import { EncryptedFunctionL2Logs, EncryptedL2Log, EncryptedL2NoteLog, EncryptedNoteFunctionL2Logs, Note, PublicExecutionRequest, UnencryptedFunctionL2Logs, UnencryptedL2Log, } from '@aztec/circuit-types';
import { PrivateCircuitPublicInputs, sortByCounter } from '@aztec/circuits.js';
import { NoteSelector } from '@aztec/foundation/abi';
import { Fr } from '@aztec/foundation/fields';
/**
 * The contents of a new note.
 */
export class NoteAndSlot {
    constructor(
    /** The note. */
    note, 
    /** The storage slot of the note. */
    storageSlot, 
    /** The note type identifier. */
    noteTypeId) {
        this.note = note;
        this.storageSlot = storageSlot;
        this.noteTypeId = noteTypeId;
    }
    toJSON() {
        return {
            note: this.note.toBuffer().toString('hex'),
            storageSlot: this.storageSlot.toBuffer().toString('hex'),
            noteTypeId: this.noteTypeId.toString(),
        };
    }
    static fromJSON(json) {
        return new NoteAndSlot(Note.fromBuffer(Buffer.from(json.note, 'hex')), Fr.fromString(json.storageSlot), NoteSelector.fromString(json.noteTypeId));
    }
}
export class CountedLog {
    constructor(log, counter) {
        this.log = log;
        this.counter = counter;
    }
    isEmpty() {
        return !this.log.data.length && !this.counter;
    }
}
export class CountedNoteLog extends CountedLog {
    constructor(log, counter, noteHashCounter) {
        super(log, counter);
        this.noteHashCounter = noteHashCounter;
    }
    toJSON() {
        return {
            log: this.log.toJSON(),
            counter: this.counter,
            noteHashCounter: this.noteHashCounter,
        };
    }
    static fromJSON(json) {
        return new CountedNoteLog(EncryptedL2NoteLog.fromJSON(json.log), json.counter, json.noteHashCounter);
    }
}
export class CountedPublicExecutionRequest {
    constructor(request, counter) {
        this.request = request;
        this.counter = counter;
    }
    isEmpty() {
        return this.request.isEmpty() && !this.counter;
    }
    toJSON() {
        return {
            request: this.request.toBuffer().toString('hex'),
            counter: this.counter,
        };
    }
    static fromJSON(json) {
        return new CountedPublicExecutionRequest(PublicExecutionRequest.fromBuffer(Buffer.from(json.request, 'hex')), json.counter);
    }
}
/**
 * The result of executing a private function.
 */
export class PrivateExecutionResult {
    constructor(
    // Needed for prover
    /** The ACIR bytecode. */
    acir, 
    /** The verification key. */
    vk, 
    /** The partial witness. */
    partialWitness, 
    // Needed for the verifier (kernel)
    /** The call stack item. */
    publicInputs, 
    /** Mapping of note hash to its index in the note hash tree. Used for building hints for note hash read requests. */
    noteHashLeafIndexMap, 
    /** The notes created in the executed function. */
    newNotes, 
    /** Mapping of note hash counter to the counter of its nullifier. */
    noteHashNullifierCounterMap, 
    /** The raw return values of the executed function. */
    returnValues, 
    /** The nested executions. */
    nestedExecutions, 
    /** Enqueued public function execution requests to be picked up by the sequencer. */
    enqueuedPublicFunctionCalls, 
    /** Public function execution requested for teardown */
    publicTeardownFunctionCall, 
    /**
     * Encrypted note logs emitted during execution of this function call.
     * Note: These are preimages to `noteEncryptedLogsHashes`.
     */
    noteEncryptedLogs, 
    /**
     * Encrypted logs emitted during execution of this function call.
     * Note: These are preimages to `encryptedLogsHashes`.
     */
    encryptedLogs, 
    /**
     * Unencrypted logs emitted during execution of this function call.
     * Note: These are preimages to `unencryptedLogsHashes`.
     */
    unencryptedLogs) {
        this.acir = acir;
        this.vk = vk;
        this.partialWitness = partialWitness;
        this.publicInputs = publicInputs;
        this.noteHashLeafIndexMap = noteHashLeafIndexMap;
        this.newNotes = newNotes;
        this.noteHashNullifierCounterMap = noteHashNullifierCounterMap;
        this.returnValues = returnValues;
        this.nestedExecutions = nestedExecutions;
        this.enqueuedPublicFunctionCalls = enqueuedPublicFunctionCalls;
        this.publicTeardownFunctionCall = publicTeardownFunctionCall;
        this.noteEncryptedLogs = noteEncryptedLogs;
        this.encryptedLogs = encryptedLogs;
        this.unencryptedLogs = unencryptedLogs;
    }
    toJSON() {
        return {
            acir: this.acir.toString('hex'),
            vk: this.vk.toString('hex'),
            partialWitness: Array.from(this.partialWitness.entries()),
            publicInputs: this.publicInputs.toJSON(),
            noteHashLeafIndexMap: Array.from(this.noteHashLeafIndexMap.entries()).map(([key, value]) => [
                key.toString(),
                value.toString(),
            ]),
            newNotes: this.newNotes.map(note => note.toJSON()),
            noteHashNullifierCounterMap: Array.from(this.noteHashNullifierCounterMap.entries()),
            returnValues: this.returnValues.map(fr => fr.toBuffer().toString('hex')),
            nestedExecutions: this.nestedExecutions.map(exec => exec.toJSON()),
            enqueuedPublicFunctionCalls: this.enqueuedPublicFunctionCalls.map(call => call.toJSON()),
            publicTeardownFunctionCall: this.publicTeardownFunctionCall.toBuffer().toString('hex'),
            noteEncryptedLogs: this.noteEncryptedLogs.map(log => log.toJSON()),
            encryptedLogs: this.encryptedLogs.map(countedLog => ({
                log: countedLog.log.toJSON(),
                counter: countedLog.counter,
            })),
            unencryptedLogs: this.unencryptedLogs.map(countedLog => ({
                log: countedLog.log.toJSON(),
                counter: countedLog.counter,
            })),
        };
    }
    static fromJSON(json) {
        return new PrivateExecutionResult(Buffer.from(json.acir, 'hex'), Buffer.from(json.vk, 'hex'), Array.isArray(json.partialWitness)
            ? new Map(json.partialWitness.map(([key, value]) => [Number(key), value]))
            : new Map(), PrivateCircuitPublicInputs.fromJSON(json.publicInputs), Array.isArray(json.noteHashLeafIndexMap)
            ? new Map(json.noteHashLeafIndexMap.map(([key, value]) => [BigInt(key), BigInt(value)]))
            : new Map(), Array.isArray(json.newNotes) ? json.newNotes.map((note) => NoteAndSlot.fromJSON(note)) : [], Array.isArray(json.noteHashNullifierCounterMap)
            ? new Map(json.noteHashNullifierCounterMap.map(([key, value]) => [Number(key), Number(value)]))
            : new Map(), json.returnValues.map((fr) => new Fr(Buffer.from(fr, 'hex'))), Array.isArray(json.nestedExecutions)
            ? json.nestedExecutions.map((exec) => PrivateExecutionResult.fromJSON(exec))
            : [], Array.isArray(json.enqueuedPublicFunctionCalls)
            ? json.enqueuedPublicFunctionCalls.map((call) => CountedPublicExecutionRequest.fromJSON(call))
            : [], PublicExecutionRequest.fromBuffer(Buffer.from(json.publicTeardownFunctionCall, 'hex')), Array.isArray(json.noteEncryptedLogs)
            ? json.noteEncryptedLogs.map((json) => CountedNoteLog.fromJSON(json))
            : [], Array.isArray(json.encryptedLogs)
            ? json.encryptedLogs.map((json) => new CountedLog(EncryptedL2Log.fromJSON(json.log), json.counter))
            : [], Array.isArray(json.unencryptedLogs)
            ? json.unencryptedLogs.map((json) => new CountedLog(UnencryptedL2Log.fromJSON(json.log), json.counter))
            : []);
    }
}
export function collectNoteHashLeafIndexMap(execResult, accum = new Map()) {
    execResult.noteHashLeafIndexMap.forEach((value, key) => accum.set(key, value));
    execResult.nestedExecutions.forEach(nested => collectNoteHashLeafIndexMap(nested, accum));
    return accum;
}
export function collectNoteHashNullifierCounterMap(execResult, accum = new Map()) {
    execResult.noteHashNullifierCounterMap.forEach((value, key) => accum.set(key, value));
    execResult.nestedExecutions.forEach(nested => collectNoteHashNullifierCounterMap(nested, accum));
    return accum;
}
/**
 * Collect all encrypted logs across all nested executions.
 * @param execResult - The topmost execution result.
 * @returns All encrypted logs.
 */
function collectNoteEncryptedLogs(execResult, noteHashNullifierCounterMap, minRevertibleSideEffectCounter) {
    return [
        execResult.noteEncryptedLogs.filter(noteLog => {
            const nullifierCounter = noteHashNullifierCounterMap.get(noteLog.noteHashCounter);
            return (nullifierCounter === undefined ||
                (noteLog.noteHashCounter < minRevertibleSideEffectCounter && nullifierCounter >= minRevertibleSideEffectCounter));
        }),
        ...execResult.nestedExecutions.flatMap(res => collectNoteEncryptedLogs(res, noteHashNullifierCounterMap, minRevertibleSideEffectCounter)),
    ].flat();
}
/**
 * Collect all encrypted logs across all nested executions and sorts by counter.
 * @param execResult - The topmost execution result.
 * @returns All encrypted logs.
 */
export function collectSortedNoteEncryptedLogs(execResult) {
    const noteHashNullifierCounterMap = collectNoteHashNullifierCounterMap(execResult);
    const minRevertibleSideEffectCounter = getFinalMinRevertibleSideEffectCounter(execResult);
    const allLogs = collectNoteEncryptedLogs(execResult, noteHashNullifierCounterMap, minRevertibleSideEffectCounter);
    const sortedLogs = sortByCounter(allLogs);
    return new EncryptedNoteFunctionL2Logs(sortedLogs.map(l => l.log));
}
/**
 * Collect all encrypted logs across all nested executions.
 * @param execResult - The topmost execution result.
 * @returns All encrypted logs.
 */
function collectEncryptedLogs(execResult) {
    return [execResult.encryptedLogs, ...execResult.nestedExecutions.flatMap(collectEncryptedLogs)].flat();
}
/**
 * Collect all encrypted logs across all nested executions and sorts by counter.
 * @param execResult - The topmost execution result.
 * @returns All encrypted logs.
 */
export function collectSortedEncryptedLogs(execResult) {
    const allLogs = collectEncryptedLogs(execResult);
    const sortedLogs = sortByCounter(allLogs);
    return new EncryptedFunctionL2Logs(sortedLogs.map(l => l.log));
}
/**
 * Collect all unencrypted logs across all nested executions.
 * @param execResult - The topmost execution result.
 * @returns All unencrypted logs.
 */
function collectUnencryptedLogs(execResult) {
    return [execResult.unencryptedLogs, ...execResult.nestedExecutions.flatMap(collectUnencryptedLogs)].flat();
}
/**
 * Collect all unencrypted logs across all nested executions and sorts by counter.
 * @param execResult - The topmost execution result.
 * @returns All unencrypted logs.
 */
export function collectSortedUnencryptedLogs(execResult) {
    const allLogs = collectUnencryptedLogs(execResult);
    const sortedLogs = sortByCounter(allLogs);
    return new UnencryptedFunctionL2Logs(sortedLogs.map(l => l.log));
}
function collectEnqueuedCountedPublicExecutionRequests(execResult) {
    return [
        ...execResult.enqueuedPublicFunctionCalls,
        ...execResult.nestedExecutions.flatMap(collectEnqueuedCountedPublicExecutionRequests),
    ];
}
/**
 * Collect all enqueued public function calls across all nested executions.
 * @param execResult - The topmost execution result.
 * @returns All enqueued public function calls.
 */
export function collectEnqueuedPublicFunctionCalls(execResult) {
    const countedRequests = collectEnqueuedCountedPublicExecutionRequests(execResult);
    // without the reverse sort, the logs will be in a queue like fashion which is wrong
    // as the kernel processes it like a stack, popping items off and pushing them to output
    return sortByCounter(countedRequests, false).map(r => r.request);
}
export function collectPublicTeardownFunctionCall(execResult) {
    const teardownCalls = [
        execResult.publicTeardownFunctionCall,
        ...execResult.nestedExecutions.flatMap(collectPublicTeardownFunctionCall),
    ].filter(call => !call.isEmpty());
    if (teardownCalls.length === 1) {
        return teardownCalls[0];
    }
    if (teardownCalls.length > 1) {
        throw new Error('Multiple public teardown calls detected');
    }
    return PublicExecutionRequest.empty();
}
export function getFinalMinRevertibleSideEffectCounter(execResult) {
    return execResult.nestedExecutions.reduce((counter, exec) => {
        const nestedCounter = getFinalMinRevertibleSideEffectCounter(exec);
        return nestedCounter ? nestedCounter : counter;
    }, execResult.publicInputs.minRevertibleSideEffectCounter.toNumber());
}
export function collectNested(executionStack, extractExecutionItems) {
    const thisExecutionReads = executionStack.flatMap(extractExecutionItems);
    return thisExecutionReads.concat(executionStack.flatMap(({ nestedExecutions }) => collectNested(nestedExecutions, extractExecutionItems)));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJpdmF0ZV9leGVjdXRpb25fcmVzdWx0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3ByaXZhdGVfZXhlY3V0aW9uX3Jlc3VsdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLGNBQWMsRUFDZCxrQkFBa0IsRUFDbEIsMkJBQTJCLEVBQzNCLElBQUksRUFDSixzQkFBc0IsRUFDdEIseUJBQXlCLEVBQ3pCLGdCQUFnQixHQUNqQixNQUFNLHNCQUFzQixDQUFDO0FBQzlCLE9BQU8sRUFBZ0IsMEJBQTBCLEVBQUUsYUFBYSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDN0YsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3JELE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUU5Qzs7R0FFRztBQUNILE1BQU0sT0FBTyxXQUFXO0lBQ3RCO0lBQ0UsZ0JBQWdCO0lBQ1QsSUFBVTtJQUNqQixvQ0FBb0M7SUFDN0IsV0FBZTtJQUN0QixnQ0FBZ0M7SUFDekIsVUFBd0I7UUFKeEIsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUVWLGdCQUFXLEdBQVgsV0FBVyxDQUFJO1FBRWYsZUFBVSxHQUFWLFVBQVUsQ0FBYztJQUM5QixDQUFDO0lBRUosTUFBTTtRQUNKLE9BQU87WUFDTCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDO1lBQzFDLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUM7WUFDeEQsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFO1NBQ3ZDLENBQUM7SUFDSixDQUFDO0lBRU0sTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFTO1FBQzlCLE9BQU8sSUFBSSxXQUFXLENBQ3BCLElBQUksQ0FB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