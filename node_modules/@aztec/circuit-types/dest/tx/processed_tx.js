import { EncryptedNoteTxL2Logs, EncryptedTxL2Logs, PublicDataWrite, TxEffect, TxHash, UnencryptedTxL2Logs, } from '@aztec/circuit-types';
import { ClientIvcProof, Fr, KernelCircuitPublicInputs, } from '@aztec/circuits.js';
import { siloL2ToL1Message } from '@aztec/circuits.js/hash';
export var PublicKernelPhase;
(function (PublicKernelPhase) {
    PublicKernelPhase[PublicKernelPhase["SETUP"] = 0] = "SETUP";
    PublicKernelPhase[PublicKernelPhase["APP_LOGIC"] = 1] = "APP_LOGIC";
    PublicKernelPhase[PublicKernelPhase["TEARDOWN"] = 2] = "TEARDOWN";
})(PublicKernelPhase || (PublicKernelPhase = {}));
export const AVM_REQUEST = 'AVM';
export function isRevertedTx(tx) {
    return !tx.data.revertCode.isOK();
}
export function partitionReverts(txs) {
    return txs.reduce(({ reverted, nonReverted }, tx) => {
        if (isRevertedTx(tx)) {
            reverted.push(tx);
        }
        else {
            nonReverted.push(tx);
        }
        return { reverted, nonReverted };
    }, { reverted: [], nonReverted: [] });
}
/**
 * Makes a processed tx out of source tx.
 * @param tx - Source tx.
 * @param kernelOutput - Output of the kernel circuit simulation for this tx.
 * @param proof - Proof of the kernel circuit for this tx.
 */
export function makeProcessedTx(tx, kernelOutput, publicProvingRequests, revertReason, gasUsed = {}, finalPublicDataUpdateRequests) {
    return {
        hash: tx.getTxHash(),
        data: kernelOutput,
        clientIvcProof: tx.clientIvcProof,
        // TODO(4712): deal with non-revertible logs here
        noteEncryptedLogs: tx.noteEncryptedLogs,
        encryptedLogs: tx.encryptedLogs,
        unencryptedLogs: tx.unencryptedLogs,
        isEmpty: false,
        revertReason,
        publicProvingRequests,
        gasUsed,
        finalPublicDataUpdateRequests: finalPublicDataUpdateRequests ?? kernelOutput.end.publicDataUpdateRequests,
    };
}
/**
 * Makes a padding empty tx with a valid proof.
 * @returns A valid padding processed tx.
 */
export function makePaddingProcessedTx(kernelOutput) {
    const hash = new TxHash(Fr.ZERO.toBuffer());
    return {
        hash,
        noteEncryptedLogs: EncryptedNoteTxL2Logs.empty(),
        encryptedLogs: EncryptedTxL2Logs.empty(),
        unencryptedLogs: UnencryptedTxL2Logs.empty(),
        data: kernelOutput.inputs,
        clientIvcProof: ClientIvcProof.empty(),
        isEmpty: true,
        revertReason: undefined,
        publicProvingRequests: [],
        gasUsed: {},
        finalPublicDataUpdateRequests: [],
        verificationKey: kernelOutput.verificationKey,
        recursiveProof: kernelOutput.proof,
    };
}
/**
 * Makes a padding empty tx with a valid proof.
 * @returns A valid padding processed tx.
 */
export function makePaddingProcessedTxFromTubeProof(kernelOutput) {
    const hash = new TxHash(Fr.ZERO.toBuffer());
    return {
        hash,
        noteEncryptedLogs: EncryptedNoteTxL2Logs.empty(),
        encryptedLogs: EncryptedTxL2Logs.empty(),
        unencryptedLogs: UnencryptedTxL2Logs.empty(),
        data: kernelOutput.inputs,
        clientIvcProof: ClientIvcProof.empty(),
        isEmpty: true,
        revertReason: undefined,
        publicProvingRequests: [],
        gasUsed: {},
        finalPublicDataUpdateRequests: [],
        verificationKey: kernelOutput.verificationKey,
        recursiveProof: kernelOutput.proof,
    };
}
/**
 * Makes an empty tx from an empty kernel circuit public inputs.
 * @returns A processed empty tx.
 */
export function makeEmptyProcessedTx(header, chainId, version, vkTreeRoot, protocolContractTreeRoot) {
    const emptyKernelOutput = KernelCircuitPublicInputs.empty();
    emptyKernelOutput.constants.historicalHeader = header;
    emptyKernelOutput.constants.txContext.chainId = chainId;
    emptyKernelOutput.constants.txContext.version = version;
    emptyKernelOutput.constants.vkTreeRoot = vkTreeRoot;
    emptyKernelOutput.constants.protocolContractTreeRoot = protocolContractTreeRoot;
    const hash = new TxHash(Fr.ZERO.toBuffer());
    return {
        hash,
        noteEncryptedLogs: EncryptedNoteTxL2Logs.empty(),
        encryptedLogs: EncryptedTxL2Logs.empty(),
        unencryptedLogs: UnencryptedTxL2Logs.empty(),
        data: emptyKernelOutput,
        clientIvcProof: ClientIvcProof.empty(),
        isEmpty: true,
        revertReason: undefined,
        publicProvingRequests: [],
        gasUsed: {},
        finalPublicDataUpdateRequests: [],
    };
}
export function toTxEffect(tx, gasFees) {
    return new TxEffect(tx.data.revertCode, tx.data.getTransactionFee(gasFees), tx.data.end.noteHashes.filter(h => !h.isZero()), tx.data.end.nullifiers.filter(h => !h.isZero()), tx.data.end.l2ToL1Msgs
        .map(message => siloL2ToL1Message(message, tx.data.constants.txContext.version, tx.data.constants.txContext.chainId))
        .filter(h => !h.isZero()), tx.finalPublicDataUpdateRequests.map(t => new PublicDataWrite(t.leafSlot, t.newValue)).filter(h => !h.isEmpty()), tx.data.end.noteEncryptedLogPreimagesLength, tx.data.end.encryptedLogPreimagesLength, tx.data.end.unencryptedLogPreimagesLength, tx.noteEncryptedLogs || EncryptedNoteTxL2Logs.empty(), tx.encryptedLogs || EncryptedTxL2Logs.empty(), tx.unencryptedLogs || UnencryptedTxL2Logs.empty());
}
function validateProcessedTxLogs(tx) {
    const noteEncryptedLogs = tx.noteEncryptedLogs || EncryptedNoteTxL2Logs.empty();
    let kernelHash = Fr.fromBuffer(EncryptedNoteTxL2Logs.hashNoteLogs(tx.data.end.noteEncryptedLogsHashes.filter(hash => !hash.isEmpty()).map(h => h.value.toBuffer())));
    let referenceHash = Fr.fromBuffer(noteEncryptedLogs.hash());
    if (!referenceHash.equals(kernelHash)) {
        throw new Error(`Note encrypted logs hash mismatch. Expected ${referenceHash.toString()}, got ${kernelHash.toString()}.
             Processed: ${JSON.stringify(noteEncryptedLogs.toJSON())}`);
    }
    const encryptedLogs = tx.encryptedLogs || EncryptedTxL2Logs.empty();
    kernelHash = kernelHash = Fr.fromBuffer(EncryptedTxL2Logs.hashSiloedLogs(tx.data.end.encryptedLogsHashes.filter(hash => !hash.isEmpty()).map(h => h.getSiloedHash())));
    referenceHash = Fr.fromBuffer(encryptedLogs.hash());
    if (!referenceHash.equals(kernelHash)) {
        throw new Error(`Encrypted logs hash mismatch. Expected ${referenceHash.toString()}, got ${kernelHash.toString()}.
             Processed: ${JSON.stringify(encryptedLogs.toJSON())}`);
    }
    const unencryptedLogs = tx.unencryptedLogs || UnencryptedTxL2Logs.empty();
    kernelHash = Fr.fromBuffer(UnencryptedTxL2Logs.hashSiloedLogs(tx.data.end.unencryptedLogsHashes.filter(hash => !hash.isEmpty()).map(h => h.getSiloedHash())));
    referenceHash = Fr.fromBuffer(unencryptedLogs.hash());
    if (!referenceHash.equals(kernelHash)) {
        throw new Error(`Unencrypted logs hash mismatch. Expected ${referenceHash.toString()}, got ${kernelHash.toString()}.
             Processed: ${JSON.stringify(unencryptedLogs.toJSON())}
             Kernel Length: ${tx.data.end.unencryptedLogPreimagesLength}`);
    }
    let referenceLength = new Fr(noteEncryptedLogs.getKernelLength());
    let kernelLength = tx.data.end.noteEncryptedLogPreimagesLength;
    if (!referenceLength.equals(kernelLength)) {
        throw new Error(`Note encrypted logs length mismatch. Expected ${referenceLength.toString()}, got ${kernelLength.toString()}.
             Processed: ${JSON.stringify(noteEncryptedLogs.toJSON())}`);
    }
    referenceLength = new Fr(encryptedLogs.getKernelLength());
    kernelLength = tx.data.end.encryptedLogPreimagesLength;
    if (!referenceLength.equals(kernelLength)) {
        throw new Error(`Encrypted logs length mismatch. Expected ${referenceLength.toString()}, got ${kernelLength.toString()}.
             Processed: ${JSON.stringify(encryptedLogs.toJSON())}`);
    }
    referenceLength = new Fr(unencryptedLogs.getKernelLength());
    kernelLength = tx.data.end.unencryptedLogPreimagesLength;
    if (!referenceLength.equals(kernelLength)) {
        throw new Error(`Unencrypted logs length mismatch. Expected ${referenceLength.toString()}, got ${kernelLength.toString()}.
             Processed: ${JSON.stringify(unencryptedLogs.toJSON())}`);
    }
}
export function validateProcessedTx(tx) {
    validateProcessedTxLogs(tx);
    // TODO: validate other fields
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzc2VkX3R4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3R4L3Byb2Nlc3NlZF90eC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wscUJBQXFCLEVBQ3JCLGlCQUFpQixFQUNqQixlQUFlLEVBT2YsUUFBUSxFQUNSLE1BQU0sRUFDTixtQkFBbUIsR0FDcEIsTUFBTSxzQkFBc0IsQ0FBQztBQUM5QixPQUFPLEVBRUwsY0FBYyxFQUNkLEVBQUUsRUFJRix5QkFBeUIsR0FPMUIsTUFBTSxvQkFBb0IsQ0FBQztBQUM1QixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUU1RCxNQUFNLENBQU4sSUFBWSxpQkFJWDtBQUpELFdBQVksaUJBQWlCO0lBQzNCLDJEQUFLLENBQUE7SUFDTCxtRUFBUyxDQUFBO0lBQ1QsaUVBQVEsQ0FBQTtBQUNWLENBQUMsRUFKVyxpQkFBaUIsS0FBakIsaUJBQWlCLFFBSTVCO0FBSUQsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLEtBQWMsQ0FBQztBQTBEMUMsTUFBTSxVQUFVLFlBQVksQ0FBQyxFQUFlO0lBQzFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNwQyxDQUFDO0FBRUQsTUFBTSxVQUFVLGdCQUFnQixDQUFDLEdBQWtCO0lBQ2pELE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FDZixDQUFDLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFO1FBQ2hDLElBQUksWUFBWSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDckIsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwQixDQUFDO2FBQU0sQ0FBQztZQUNOLFdBQVcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDdkIsQ0FBQztRQUNELE9BQU8sRUFBRSxRQUFRLEVB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